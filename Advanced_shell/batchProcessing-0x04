#!/bin/bash
# Task 5: Parallel Data Fetching
# Fetch Pokémon data in parallel

POKEMON_LIST=(bulbasaur ivysaur venusaur charmander charmeleon)
DATA_DIR="pokemon_data"
API_URL="https://pokeapi.co/api/v2/pokemon"
ERROR_LOG="errors.txt"

mkdir -p "$DATA_DIR"
PIDS=()

for NAME in "${POKEMON_LIST[@]}"; do
    echo "Fetching data for $NAME..."
    OUTFILE="$DATA_DIR/$NAME.json"
    (
        curl -s "$API_URL/$NAME" -o "$OUTFILE"
        if [ $? -eq 0 ] && [ -s "$OUTFILE" ]; then
            echo "Saved data to $OUTFILE ✅"
        else
            echo "Error fetching $NAME" >> "$ERROR_LOG"
            rm -f "$OUTFILE"
        fi
    ) &
    PIDS+=( $! )
done

# Wait for all background jobs
for PID in "${PIDS[@]}"; do
    wait $PID
done

echo "All fetches complete."
